#include <iostream>
#include "cbc/plaintext_processor.hpp"
#include "cbc/CBC.hpp"
#include "cbc/keys.hpp"
#include "cbc/iv_generator.hpp"

using namespace std;

int main() {
    string plaintext = "0100001101110010011110010111000001110100011011110110011101110010011000010111000001101000011110010010110000100000011011110111001000100000011000110111001001111001011100000111010001101111011011000110111101100111011110010010110000100000011010010111001100100000011101000110100001100101001000000111000001110010011000010110001101110100011010010110001101100101001000000110000101101110011001000010000001110011011101000111010101100100011110010010000001101111011001100010000001110100011001010110001101101000011011100110100101110001011101010110010101110011001000000110011001101111011100100010000001110011011001010110001101110101011100100110010100100000011000110110111101101101011011010111010101101110011010010110001101100001011101000110100101101111011011100010000001101001011011100010000001110100011010000110010100100000011100000111001001100101011100110110010101101110011000110110010100100000011011110110011000100000011000010110010001110110011001010111001001110011011000010111001001101001011000010110110000100000011000100110010101101000011000010111011001101001011011110111001000101110";
    bitset<64> originalKey(0x0123456789ABCDEF); // 64-bit original key
    bitset<64> initialVector = generateRandomIV();

    plaintext = padPlaintext(plaintext);
    vector<bitset<64>> data = splitPlaintext(plaintext);
    // Perform DES encryption
    vector<bitset<64>> encryptedData = encryptCBC(data, originalKey, initialVector);

    cout << "Key: \t\t" << hex << originalKey.to_ullong() << "\t\t" << originalKey << endl;
    cout << "IV: \t\t" << hex << initialVector.to_ullong() << "\t\t" << initialVector << endl;
    int i;
    for (const bitset<64>& block:encryptedData){

        cout << "Block " << i++ << ": \t" << block << endl;
    }
    

    return 0;
}
